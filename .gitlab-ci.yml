.template:
  image: nixos/nix
  retry: 2
  before_script:
    # report CPU info so we can monitor if real KVM becomes available. create /dev/kvm to fool nix
    - cat /proc/cpuinfo
    - ls -l /dev/kvm || true
    - touch /dev/kvm
  script:
    - nix-build tests/default.nix -A ${SUITE}.${VERSION} --arg nonKVM true

19-09-intern:
  extends: .template
  variables:
    VERSION: "nixpkgs_19_09"
    SUITE:   "intern"

19-09-extern:
  extends: .template
  variables:
    VERSION: "nixpkgs_19_09"
    SUITE:   "extern"

19-09-clamav:
  extends: .template
  variables:
    VERSION: "nixpkgs_19_09"
    SUITE:   "clamav"

unstable-intern:
  extends: .template
  variables:
    VERSION: "nixpkgs_unstable"
    SUITE:   "intern"

nixpkgs_unstable-extern:
  extends: .template
  variables:
    VERSION: "nixpkgs_unstable"
    SUITE:   "extern"

nixpkgs_unstable-clamav:
  extends: .template
  variables:
    VERSION: "nixpkgs_unstable"
    SUITE:   "clamav"
